description: |
  An EPICS areaDetector driver for the Pilatus pixel array detectors from Dectris.
bases:
  - $(ADCORE)/ADSrc/ADBase.pvi.yaml
  - $(ADCORE)/ADSrc/NDFile.pvi.yaml
local: $(basename).local.yaml
macros:
  - type: StringMacro
    name: P
    description: Record prefix part 1
  - type: StringMacro
    name: R
    description: Record prefix part 2
  - type: StringMacro
    name: PORT
    description: Asyn port name
  - type: FloatMacro
    name: TIMEOUT
    description: The timeout for records talking to the driver
    value: 1
  - type: FloatMacro
    name: ADDR
    description: The address for the asyn port
    value: 0
producer:
  type: AsynProducer
  prefix: $(P)$(R)
  asyn_port: $(PORT)
  address: $(ADDR)
  timeout: $(TIMEOUT)
formatter:
  type: DLSFormatter
startup: |
  drvAsynIPPortConfigure("camserver","gse-pilatus1:41234")
  # Uncomment the following to enable asynTrace on the camserver port
  #asynSetTraceIOMask("camserver",0,2)
  #asynSetTraceMask("camserver",0,9)
  # Set the input and output terminators.
  asynOctetSetInputEos("camserver", 0, "\030")
  asynOctetSetOutputEos("camserver", 0, "\n")
  dbLoadRecords("pilatus.template", "P=$(P),R=$(R),PORT=$(PORT),ADDR=$(ADDR),TIMEOUT=$(TIMEOUT),CAMSERVER_PORT=$(CAMSERVER_PORT)")
screens:
  - ../op/opi/DLS/pilatus.opi  # summary screen, links to pilatus_parameters.opi
components:
  - type: Group
    name: AncilliaryInformation
    children:
      - type: AsynFloat64
        name: ThresholdEnergy
        description: |
          Threshold energy in keV

          camserver uses this value to set the discriminators in each pixel.
          It is typically set to the incident x-ray energy ($(P)$(R)Energy),
          but sometimes other values may be preferable.
        precision: 3
        units: keV
        initial: 10
        autosave:
          - VAL
        role: Setting Pair

